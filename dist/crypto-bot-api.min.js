var CryptoBotAPI=function(){"use strict";var t,e,n,r,o,a=function(t,e){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},a(t,e)};"function"==typeof SuppressedError&&SuppressedError,function(t){t.Crypto="crypto",t.Fiat="fiat",t.Unknown="unknown"}(t||(t={})),function(t){t.Blockchain="blockchain",t.Stablecoin="stablecoin",t.Fiat="fiat",t.Unknown="unknown"}(e||(e={})),function(t){t.Active="active",t.Paid="paid",t.Expired="expired",t.Unknown="unknown"}(n||(n={})),function(t){t.Active="active",t.Activated="activated",t.Unknown="unknown"}(r||(r={})),function(t){t.Completed="completed",t.Unknown="unknown"}(o||(o={}));var i=function(t){return Array.isArray(t)?t.reduce((function(t,n){if(n.code){var r=n.code.toString(),o=e.Unknown;n.is_blockchain&&(o=e.Blockchain),n.is_fiat&&(o=e.Fiat),n.is_stablecoin&&(o=e.Stablecoin);var a={code:r,name:n.name||"",decimals:n.decimals||0,type:o};Object.prototype.hasOwnProperty.call(n,"url")&&(a.url=n.url),t[r]=a}return t}),{}):{}},s=function(t){return Array.isArray(t)?t.map((function(t){return{source:t.source||"",target:t.target||"",rate:t.rate,isValid:t.is_valid}})):[]},c=function(e){var r={id:e.invoice_id||0,status:e.status||n.Unknown,hash:e.hash||"",currencyType:e.currency_type||"",currency:e.asset||e.fiat||"",amount:e.amount||"0",isAllowComments:e.allow_comments||!1,isAllowAnonymous:e.allow_anonymous||!1,createdAt:new Date(e.created_at),botPayUrl:e.bot_invoice_url||"",miniAppPayUrl:e.mini_app_invoice_url||"",webAppPayUrl:e.web_app_invoice_url||""};if(r.currencyType===t.Crypto&&(r.currency=e.asset||""),r.currencyType===t.Fiat&&(r.currency=e.fiat||""),void 0!==e.hidden_message&&(r.hiddenMessage=e.hidden_message),void 0!==e.paid_anonymously&&(r.isPaidAnonymously=e.paid_anonymously),void 0!==e.expiration_date&&(r.expirationDate=new Date(e.expiration_date)),void 0!==e.paid_at&&(r.paidAt=new Date(e.paid_at)),void 0!==e.description&&(r.description=e.description),void 0!==e.paid_btn_name&&(r.paidBtnName=e.paid_btn_name),void 0!==e.paid_btn_url&&(r.paidBtnUrl=e.paid_btn_url),void 0!==e.comment&&(r.comment=e.comment),void 0!==e.paid_usd_rate&&(r.usdRate=parseFloat(e.paid_usd_rate)||0),void 0!==e.fee_asset&&(r.feeAsset=e.fee_asset||""),void 0!==e.fee_amount&&(r.fee=e.fee_amount||0),void 0!==e.accepted_assets&&(r.acceptedAssets=e.accepted_assets),void 0!==e.paid_asset&&(r.paidAsset=e.paid_asset||""),void 0!==e.paid_amount&&(r.paidAmount=parseFloat(e.paid_amount)||0),void 0!==e.paid_fiat_rate&&(r.paidFiatRate=parseFloat(e.paid_fiat_rate)||0),void 0!==e.payload){var o=void 0;try{o=JSON.parse(e.payload)}catch(t){o=e.payload}r.payload=o}return void 0!==e.swap_to&&(r.swapTo=e.swap_to,r.isSwapped=e.is_swapped,r.isSwapped&&(r.swappedUid=e.swapped_uid||"",r.swappedTo=e.swapped_to||"",r.swappedRate=parseFloat(e.swapped_rate)||0,r.swappedOutput=e.swapped_output||"",r.swappedUsdAmount=e.swapped_usd_amount||"",r.swappedUsdRate=parseFloat(e.swapped_usd_rate)||0)),r},u=function(t){var e={id:t.check_id||0,hash:t.hash||"",asset:t.asset||"",amount:t.amount||"0",botCheckUrl:t.bot_check_url||"",status:t.status||r.Unknown,createdAt:new Date(t.created_at)};return void 0!==t.activated_at&&(e.activatedAt=new Date(t.activated_at)),void 0!==t.pin_to_user&&void 0!==t.pin_to_user.pin_by&&("id"===t.pin_to_user.pin_by&&void 0!==t.pin_to_user.user_id&&(e.pinToUserId=t.pin_to_user.user_id),"username"===t.pin_to_user.pin_by&&void 0!==t.pin_to_user.username&&(e.pinToUsername=t.pin_to_user.username)),e},d=function(t){var e={id:t.transfer_id||0,userId:t.user_id||0,asset:t.asset||"",amount:t.amount||"0",status:t.status||o.Unknown,completedAt:new Date(t.completed_at)};return void 0!==t.spend_id&&(e.spendId=t.spend_id),void 0!==t.comment&&(e.comment=t.comment),e},p=function(t){var e=[];return Array.isArray(t.items)&&(e=t.items.map(c)),e},f=function(t){var e=[];return Array.isArray(t.items)&&(e=t.items.map(u)),e},_=function(t){var e=[];return Array.isArray(t.items)&&(e=t.items.map(d)),e},l=function(t){return{id:t.app_id||0,name:t.name||"",bot:t.payment_processing_bot_username||""}},v=/^https?:\/\/((([a-z\d][a-z\d-]*[a-z\d])\.)+[a-z]{2,}|((\d{1,3}\.){3}\d{1,3}))(:\d+)?(\/[-a-z\d%_.~+]*)*$/i,h=function(t){if("number"!=typeof t||isNaN(t)||t<1)throw new Error("Identifier must be a valid positive number");return t},y=function(){function t(e,n){if(!t.KEY_CHECK_REGEXP.test(e))throw new Error("API key looks like invalid");var r,o;if("mainnet"===n)r="https://pay.crypt.bot/api";else if("testnet"===n)r="https://testnet-pay.crypt.bot/api";else{if(o=n,!v.test(o))throw new Error("Endpoint parameter not contain valid URL");r=n}this._apiKey=e,this._baseUrl="".concat(r,"/")}return t.prototype.call=function(t,e){var n,r,o="";return e&&Object.keys(e).forEach((function(t){var n=e[t];n=Array.isArray(n)?n.join(","):n.toString(),o+="&".concat(t,"=").concat(encodeURIComponent(n))})),(n=this._baseUrl+t+(o.length?"?".concat(o.substr(1)):""),r=this._apiKey,new Promise((function(t,e){var o=new XMLHttpRequest;o.open("GET",n,!0),o.setRequestHeader("Crypto-Pay-API-Token",r),o.onreadystatechange=function(){4===o.readyState&&t(o.responseText)},o.onerror=function(){e(new Error("Network Error"))},o.send()}))).then((function(t){var e;try{e=JSON.parse(t)}catch(e){throw new Error("Response parse error, raw reponse:\n".concat(t))}if(!0!==e.ok){if(!e.error)throw new Error("Api response unknown error");throw new Error("Api response error ".concat(JSON.stringify(e.error)))}return e.result}))},t.KEY_CHECK_REGEXP=/\d{1,}:[a-zA-Z0-9]{35}/,t}(),m=function(t,e,n,r){var o,a=null,i=0;return function(s){if(void 0===s&&(s=!1),a)return a;var c=Math.floor(+new Date/1e3/r);return c!==i||s?(i=c,a=t.call(e).then((function(t){return o=n(t),a=null,o}))):Promise.resolve(o)}},w=function(i){function s(){var t=null!==i&&i.apply(this,arguments)||this;return t._pageSize=100,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(s,i),s.prototype.getPageSize=function(){return this._pageSize},s.prototype.setPageSize=function(t){var e=+t;if(e>1e3||e<1)throw Error("Page size may be from 1 to 1000");this._pageSize=e},s.prototype.getStats=function(t){return void 0===t&&(t={}),this._transport.call("getStats",function(t){var e={};if(void 0===t.startAt&&void 0===t.endAt)return e;if(void 0===t.startAt||!(t.startAt instanceof Date))throw new Error("Field `startAt` must be a Date");if(void 0===t.endAt||!(t.endAt instanceof Date))throw new Error("Field `endAt` must be a Date");return e.start_at=t.startAt.toISOString(),e.end_at=t.endAt.toISOString(),e}(t)).then((function(t){return{volume:(e=t).volume||"0",conversion:e.conversion||"0",uniqueUsersCount:e.unique_users_count||0,createdInvoiceCount:e.created_invoice_count||0,paidInvoiceCount:e.paid_invoice_count||0,startAt:new Date(e.start_at?e.start_at:0),endAt:new Date(e.end_at?e.end_at:0)};var e}))},s.prototype.getBalances=function(){return this._transport.call("getBalance").then((function(t){return function(t){if(!Array.isArray(t))throw new Error("Input is not array: ".concat(JSON.stringify(t)));return t.reduce((function(t,e){return t[e.currency_code]={available:e.available,onhold:e.onhold},t}),{})}(t)}))},s.prototype.getBalancesAvailable=function(){return this.getBalances().then((function(t){return Object.entries(t).reduce((function(t,e){var n=e[0],r=e[1];return t[n]=r.available,t}),{})}))},s.prototype.getBalancesOnhold=function(){return this.getBalances().then((function(t){return Object.entries(t).reduce((function(t,e){var n=e[0],r=e[1];return t[n]=r.onhold,t}),{})}))},s.prototype.getBalance=function(t){return this.getBalances().then((function(e){return void 0===e[t]?{available:"0",onhold:"0"}:e[t]}))},s.prototype.getBalanceAvailable=function(t){return this.getBalances().then((function(e){return void 0===e[t]?"0":e[t].available}))},s.prototype.getBalanceOnhold=function(t){return this.getBalances().then((function(e){return void 0===e[t]?"0":e[t].onhold}))},s.prototype.getCurrency=function(t,e){return void 0===e&&(e=!1),this.getCurrencies(e).then((function(e){return void 0===e[t]?null:e[t]}))},s.prototype.getExchangeRate=function(t,e,n){return void 0===n&&(n=!1),this.getExchangeRates(n).then((function(n){return function(t,e,n){for(var r="",o=0,a=n.length;o<a;o+=1){var i=n[o];if(i.source===t&&i.target===e){i.isValid&&(r=i.rate);break}}return""===r?"0":r}(t,e,n)}))},s.prototype.transfer=function(t){return this._transport.call("transfer",function(t){if(void 0!==t.comment&&t.comment.length>1024)throw new Error("Comment can't be longer than 1024 characters");var e={user_id:t.userId,spend_id:t.spendId,asset:t.asset,amount:"number"==typeof t.amount?""+t.amount:t.amount};return void 0!==t.disableSendNotification&&(e.disable_send_notification=t.disableSendNotification),void 0!==t.comment&&(e.comment=t.comment),e}(t)).then((function(t){return d(t)}))},s.prototype.createInvoice=function(e){return this._transport.call("createInvoice",function(e){if(void 0!==e.description&&e.description.length>1024)throw new Error("Description can't be longer than 1024 characters");if(void 0!==e.paidBtnName&&!e.paidBtnUrl)throw new Error("Require paidBtnUrl parameter if paidBtnName parameter pass");if(void 0!==e.hiddenMessage&&e.hiddenMessage.length>2048)throw new Error("Hidden message can't be longer than 2048 characters");if(void 0!==e.expiresIn&&("number"!=typeof e.expiresIn||e.expiresIn<1||e.expiresIn>2678400))throw new Error("Expires must be a number between 1-2678400");var n;if(void 0!==e.payload&&(n="string"==typeof e.payload?e.payload:JSON.stringify(e.payload)).length>4096)throw new Error("Payload can't be longer than 4096 characters");var r={amount:"number"==typeof e.amount?""+e.amount:e.amount},o=e.currencyType||t.Crypto;if(r.currency_type=o,o===t.Crypto){var a=e.asset;if(!a)throw new Error("Field `asset` required for crypto currency type");r.asset=a}if(o===t.Fiat){var i=e.fiat;if(!i)throw new Error("Field `fiat` required for fiat currency type");if(r.fiat=i,void 0!==e.acceptedAssets){if(!Array.isArray(e.acceptedAssets))throw new Error("Field `acceptedAssets` must be array");r.accepted_assets=e.acceptedAssets.join(",")}}return void 0!==e.expiresIn&&(r.expires_in=e.expiresIn),void 0!==e.description&&(r.description=e.description),void 0!==e.hiddenMessage&&(r.hidden_message=e.hiddenMessage),void 0!==n&&(r.payload=n),void 0!==e.swapTo&&(r.swap_to=e.swapTo),void 0!==e.paidBtnUrl&&(r.paid_btn_url=e.paidBtnUrl),void 0!==e.paidBtnName&&(r.paid_btn_name=e.paidBtnName),void 0!==e.isAllowComments&&(r.allow_comments=e.isAllowComments),void 0!==e.isAllowAnonymous&&(r.allow_anonymous=e.isAllowAnonymous),r}(e)).then((function(t){return c(t)}))},s.prototype.createCheck=function(t){return this._transport.call("createCheck",function(t){var e={asset:t.asset,amount:"number"==typeof t.amount?""+t.amount:t.amount};if(void 0!==t.pinToUserId&&(e.pin_to_user_id=t.pinToUserId),void 0!==t.pinToUsername&&(e.pin_to_username=t.pinToUsername),void 0!==t.pinToUserId&&void 0!==t.pinToUsername)throw new Error("Pass only one of `pinToUserId` and `pinToUsername`");return e}(t)).then((function(t){return u(t)}))},s.prototype.deleteInvoice=function(t){return this._transport.call("deleteInvoice",{invoice_id:h(t)})},s.prototype.deleteCheck=function(t){return this._transport.call("deleteCheck",{check_id:h(t)})},s.prototype.getInvoices=function(t){return void 0===t&&(t={}),this._transport.call("getInvoices",function(t){var e={};return void 0!==t.status&&(e.status=t.status),void 0!==t.offset&&(e.offset=t.offset),void 0!==t.count&&(e.count=t.count),void 0!==t.asset&&(e.asset=t.asset),void 0!==t.fiat&&(e.fiat=t.fiat),void 0!==t.ids&&(e.invoice_ids=t.ids.join(",")),e}(t)).then((function(t){return p(t)}))},s.prototype.getInvoicesPaginate=function(t){void 0===t&&(t={});var e=function(t,e){var n={};void 0!==e.status&&(n.status=e.status),void 0!==e.asset&&(n.asset=e.asset),void 0!==e.fiat&&(n.fiat=e.fiat),void 0!==e.ids&&(n.invoice_ids=e.ids.join(","));var r=e.page?+e.page:1;return r<1&&(r=1),n.count=t,n.offset=t*(r-1),n}(this._pageSize,t);return this._transport.call("getInvoices",e).then((function(t){return p(t)}))},s.prototype.getChecks=function(t){return void 0===t&&(t={}),this._transport.call("getChecks",function(t){var e={};return void 0!==t.status&&(e.status=t.status),void 0!==t.offset&&(e.offset=t.offset),void 0!==t.count&&(e.count=t.count),void 0!==t.asset&&(e.asset=t.asset),void 0!==t.ids&&(e.check_ids=t.ids.join(",")),e}(t)).then((function(t){return f(t)}))},s.prototype.getChecksPaginate=function(t){void 0===t&&(t={});var e=function(t,e){var n={};void 0!==e.status&&(n.status=e.status),void 0!==e.asset&&(n.asset=e.asset),void 0!==e.ids&&(n.check_ids=e.ids.join(","));var r=e.page?+e.page:1;return r<1&&(r=1),n.count=t,n.offset=t*(r-1),n}(this._pageSize,t);return this._transport.call("getChecks",e).then((function(t){return f(t)}))},s.prototype.getTransfers=function(t){return void 0===t&&(t={}),this._transport.call("getTransfers",function(t){var e={};return void 0!==t.offset&&(e.offset=t.offset),void 0!==t.count&&(e.count=t.count),void 0!==t.asset&&(e.asset=t.asset),void 0!==t.spendId&&(e.spend_id=t.spendId),void 0!==t.ids&&(e.transfer_ids=t.ids.join(",")),e}(t)).then((function(t){return _(t)}))},s.prototype.getTransfersPaginate=function(t){void 0===t&&(t={});var e=function(t,e){var n={};void 0!==e.asset&&(n.asset=e.asset),void 0!==e.spendId&&(n.spend_id=e.spendId),void 0!==e.ids&&(n.transfer_ids=e.ids.join(","));var r=e.page?+e.page:1;return r<1&&(r=1),n.count=t,n.offset=t*(r-1),n}(this._pageSize,t);return this._transport.call("getTransfers",e).then((function(t){return _(t)}))},s.prototype.call=function(t,e){return void 0===e&&(e={}),this._transport.call(t,e)},s.CurrencyType=t,s.DetailedCurrencyType=e,s.InvoiceStatus=n,s.CheckStatus=r,s.TransferStatus=o,s}(function(){function t(t,e){void 0===e&&(e="mainnet"),this._transport=new y(t,e)}return t.prototype.getCurrencies=function(e){return this._currenciesFetchHandler||(this._currenciesFetchHandler=m(this._transport,"getCurrencies",i,t._CURRENCIES_UPDATE_PERIOD)),this._currenciesFetchHandler(e)},t.prototype.getExchangeRates=function(e){return this._exchangeRatesFetchHandler||(this._exchangeRatesFetchHandler=m(this._transport,"getExchangeRates",s,t._EXCHANGE_RATES_UPDATE_PERIOD)),this._exchangeRatesFetchHandler(e)},t.prototype.getMe=function(e){return void 0===e&&(e=!1),this._meFetchHandler||(this._meFetchHandler=m(this._transport,"getMe",l,t._ME_UPDATE_PERIOD)),this._meFetchHandler(e)},t._CURRENCIES_UPDATE_PERIOD=3600,t._EXCHANGE_RATES_UPDATE_PERIOD=60,t._ME_UPDATE_PERIOD=3600,t}());return w}();
//# sourceMappingURL=crypto-bot-api.min.js.map
